<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tower Defense Completo</title>
<style>
  body{margin:0;font-family:Arial;background:#0b1220;color:#e6eef6}
  #game{display:grid;grid-template-columns:820px 340px;gap:18px;padding:18px;max-width:1180px;margin:20px auto}
  canvas{border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,.6);background:#87ceeb}
  .panel{background:#0f1724;padding:14px;border-radius:12px;box-shadow:inset 0 1px 0 rgba(255,255,255,.02)}
  h2{margin:0 0 8px 0;font-size:16px}
  .row{display:flex;gap:8px;align-items:center}
  button{background:#7dd3fc;border:none;padding:8px 10px;border-radius:8px;cursor:pointer;color:#000;font-weight:bold}
  .muted{color:#94a3b8;font-size:13px}
  .tower-btn{display:block;margin:8px 0;padding:8px;border-radius:8px;background:#0b2130;border:1px solid rgba(255,255,255,.03);cursor:pointer;transition:background 0.3s}
  .tower-btn:hover{background:#123b56}
  .upgrade-btn{background:#1e293b;color:white;margin:4px 0;width:100%;border:none;border-radius:6px;padding:6px;cursor:pointer}
  .upgrade-btn:hover{background:#334155}
</style>
</head>
<body>
<div id="game">
  <div>
    <canvas id="c" width="820" height="600"></canvas>
  </div>
  <div class="panel">
    <h2>Informações</h2>
    <div class="muted small">Wave: <span id="wave">0</span> / <span id="maxWave">60+</span></div>
    <div class="muted small">Vida da base: <span id="lives">20</span></div>
    <div class="muted small">Moedas: <span id="gold">100</span></div>
    <div style="height:8px"></div>
    <div class="row">
      <button id="start">Iniciar/Próxima Wave</button>
      <button id="speed">x1</button>
      <button id="auto">Auto: Off</button>
    </div>
    <h2>Construir torres</h2>
    <div id="towers"></div>
    <h2>Torre Selecionada</h2>
    <div id="selInfo" class="muted small">Clique no mapa para construir ou selecionar uma torre.</div>
    <div id="upgradePanel"></div>
    <button id="sell" class="muted small">Vender torre (50%)</button>
    <h2>Mensagens</h2>
    <div id="log" class="muted small" style="height:180px;overflow:auto;background:#07131a;padding:8px;border-radius:8px;margin-top:8px"></div>
  </div>
</div>
<script>
// --- CONFIGURAÇÃO ---
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let wave = 0;
let lives = 20;
let gold = 100;
let autoWave = false;
let gameSpeed = 1;
const maxWave = 60;

const pathColor = "#654321";
const grassColor = "#4caf50";

// Caminho curvo (pontos de referência)
const path = [
  {x:0,y:260},{x:200,y:260},{x:200,y:400},{x:600,y:400},{x:600,y:200},{x:820,y:200}
];

// Torres
let towers = [];
let selectedTower = null;
const towerTypes = [
  {name:"Canhão",cost:50,range:80,dmg:10,spd:1,crit:0.1,critDmg:2},
  {name:"Arco",cost:70,range:120,dmg:6,spd:2,crit:0.2,critDmg:3},
  {name:"Mágica",cost:100,range:150,dmg:15,spd:0.8,crit:0.15,critDmg:2.5}
];

// Inimigos
let enemies = [];
class Enemy{
  constructor(x,y,hp,speed,type){
    this.x=x; this.y=y; this.hp=hp; this.maxHp=hp; this.speed=speed;
    this.pathIndex=0; this.dead=false; this.damagePopups=[];
    this.type=type;
  }
  move(){
    if(this.pathIndex>=path.length){return;}
    let target = path[this.pathIndex];
    let dx = target.x - this.x;
    let dy = target.y - this.y;
    let dist = Math.sqrt(dx*dx+dy*dy);
    if(dist<1){this.pathIndex++; if(this.pathIndex>=path.length){lives--; this.dead=true;}} 
    else {this.x += dx/dist*this.speed*gameSpeed; this.y += dy/dist*this.speed*gameSpeed;}
  }
  draw(){
    // corpo
    ctx.fillStyle=this.type==="boss"?"darkred":this.type==="elite"?"orange":"red";
    ctx.beginPath();
    ctx.arc(this.x,this.y,12,0,Math.PI*2);
    ctx.fill();
    // HP
    ctx.fillStyle="black"; ctx.fillRect(this.x-15,this.y-20,30,5);
    ctx.fillStyle="lime"; ctx.fillRect(this.x-15,this.y-20,30*(this.hp/this.maxHp),5);
    // dano flutuante
    this.damagePopups.forEach(p=>{
      ctx.fillStyle="yellow"; ctx.font="14px Arial"; ctx.fillText(p.dmg,p.x,p.y);
      p.y-=0.5; p.alpha-=0.02;
    });
    this.damagePopups=this.damagePopups.filter(p=>p.alpha>0);
  }
}

// --- FUNÇÕES ---
function spawnWave(){
  wave++;
  document.getElementById("wave").textContent=wave;
  for(let i=0;i<10;i++){
    let type="normal";
    if(wave%10===0) type="elite";
    if(wave===maxWave) type="boss";
    let hp=50+wave*5; if(type==="elite") hp*=3; if(type==="boss") hp*=8;
    let speed=1+wave*0.02; if(type==="elite") speed*=1.2; if(type==="boss") speed*=0.8;
    setTimeout(()=>enemies.push(new Enemy(path[0].x,path[0].y,hp,speed,type)),i*500);
  }
}

function drawMap(){
  // fundo
  ctx.fillStyle=grassColor; ctx.fillRect(0,0,canvas.width,canvas.height);
  // caminho
  ctx.strokeStyle=pathColor; ctx.lineWidth=40;
  ctx.beginPath(); ctx.moveTo(path[0].x,path[0].y);
  for(let i=1;i<path.length;i++) ctx.lineTo(path[i].x,path[i].y);
  ctx.stroke();
  // árvores decorativas
  ctx.fillStyle="#228B22"; for(let i=0;i<10;i++){ctx.beginPath(); ctx.arc(50+i*80,50,20,0,Math.PI*2); ctx.fill();}
  // torres
  towers.forEach(t=>{
    ctx.fillStyle="gray"; ctx.beginPath(); ctx.arc(t.x,t.y,15,0,Math.PI*2); ctx.fill();
  });
  // inimigos
  enemies.forEach(e=>{if(!e.dead)e.draw();});
}

function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMap();
  enemies.forEach(e=>{if(!e.dead)e.move();});
  requestAnimationFrame(gameLoop);
}

// --- EVENTOS ---
canvas.addEventListener("click",e=>{
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX-rect.left;
  const y = e.clientY-rect.top;
  if(selectedTower){
    selectedTower.x=x; selectedTower.y=y;
    selectedTower=null;
    document.getElementById("upgradePanel").innerHTML="";
  } else {
    // coloca nova torre
    let tType = towerTypes[0];
    if(gold>=tType.cost){
      gold-=tType.cost; document.getElementById("gold").textContent=gold;
      towers.push({x,y,type:tType,level:1});
    }
  }
});

document.getElementById("start").addEventListener("click",()=>spawnWave());
document.getElementById("speed").addEventListener("click",()=>{
  gameSpeed=gameSpeed===1?2:1; document.getElementById("speed").textContent="x"+gameSpeed;
});
document.getElementById("auto").addEventListener("click",()=>{
  autoWave=!autoWave; document.getElementById("auto").textContent="Auto: "+(autoWave?"On":"Off");
  if(autoWave){setInterval(()=>{if(enemies.length===0) spawnWave();},2000);}
});

// painel torres
const towersDiv=document.getElementById("towers");
towerTypes.forEach((tt,i)=>{
  let btn=document.createElement("button"); btn.className="tower-btn"; btn.textContent=tt.name+" ($"+tt.cost+")";
  btn.onclick=()=>{selectedTower={type:tt,level:1}; document.getElementById("selInfo").textContent="Clique no mapa para colocar "+tt.name;};
  towersDiv.appendChild(btn);
});

gameLoop();
</script>
</body>
</html>
